#pragma once

#include "ParameterGroup.h"

/**
 * @class ParametersHS321
 * @brief Класс для управления параметрами и ошибками частотного преобразователя HS321.
 *
 * Инкапсулирует информацию о параметрах устройства, сгруппированных по функциональному признаку,
 * а также предоставляет доступ к описаниям кодов ошибок и метаданным моделей.
 * Класс использует массив объектов ParameterGroup для организации параметров.
 */
class ParametersHS321 {
public:
    /**
     * @brief Конструктор класса.
     *
     * Инициализирует объект для работы с параметрами указанной модели частотного преобразователя.
     *
     * @param model Модель устройства (например, MODEL_1_5, MODEL_7_5 и т.д.).
     */
    explicit ParametersHS321(Model model);

    /**
     * @brief Деструктор класса.
     *
     * Освобождает ресурсы, используемые объектом (например, память групп параметров).
     */
    ~ParametersHS321();

    /**
     * @brief Получение номинальной мощности модели двигателя.
     *
     * Возвращает значение мощности в ваттах для указанной модели.
     *
     * @param model Модель частотного преобразователя.
     * @return Мощность модели в ваттах.
     */
    static float getPower(Model model);

    /**
     * @brief Получение информации об ошибке по её коду.
     *
     * Ищет в таблице ошибок запись с указанным кодом и возвращает указатель на неё.
     * Если ошибка не найдена, возвращает nullptr.
     *
     * @param code Код ошибки (например, 14 — перегрев).
     * @return Указатель на структуру FaultInfo с описанием ошибки или nullptr, если не найдена.
     */
    const FaultInfo* getFaultInfo(int code) const;

    /**
     * @brief Создание параметра с типом float.
     *
     * Возвращает структуру Parameter, заполненную переданными значениями.
     * Используется для параметров с плавающей точкой, таких как частота, ток, напряжение.
     *
     * @param name Название параметра (например, "Частота задания").
     * @param defaultValue Значение по умолчанию.
     * @param unit Единица измерения (например, "Гц", "А").
     * @param min Минимальное допустимое значение.
     * @param max Максимальное допустимое значение.
     * @param description Подробное описание параметра.
     * @return Объект Parameter, заполненный переданными данными.
     */
    static Parameter createParameter(const char* name, float defaultValue, const char* unit, float min, float max, const char* description);

    /**
     * @brief Создание параметра с типом int.
     *
     * Возвращает структуру Parameter для целочисленных значений.
     * Используется для параметров, задаваемых как целые числа (например, время в секундах).
     *
     * @param name Название параметра.
     * @param defaultValue Значение по умолчанию.
     * @param unit Единица измерения.
     * @param min Минимальное значение.
     * @param max Максимальное значение.
     * @param description Описание параметра.
     * @return Объект Parameter.
     */
    static Parameter createParameter(const char* name, int defaultValue, const char* unit, int min, int max, const char* description);

    /**
     * @brief Создание параметра с типом строка (const char*).
     *
     * Используется для параметров, значения которых представлены текстом (например, "Включено", "Отключено").
     *
     * @param name Название параметра.
     * @param defaultValue Значение по умолчанию (строка).
     * @param unit Единица измерения (может быть пустой).
     * @param min Минимальное значение (в виде строки).
     * @param max Максимальное значение (в виде строки).
     * @param description Описание параметра.
     * @return Объект Parameter.
     */
    static Parameter createParameter(const char* name, const char* defaultValue, const char* unit, const char* min, const char* max, const char* description);

private:
    /**
     * @var _allParameters
     * @brief Массив групп параметров, по одной на каждую группу (F0, F1, ..., d).
     * Каждая группа содержит параметры, объединённые по функциональному назначению.
     */
    ParameterGroup _allParameters[GroupsParameter::GROUP_COUNT];

    /**
     * @var _model
     * @brief Хранит текущую модель частотного преобразователя.
     *
     * Используется для получения соответствующих параметров и мощности.
     */
    Model _model;

    /**
     * @def _faultCount
     * @brief Количество кодов ошибок в таблице.
     *
     * Определяет размер массива _faultTable.
     */
    static constexpr int _faultCount = 27;

    /**
     * @var _faultTable
     * @brief Таблица описаний ошибок частотного преобразователя.
     *
     * Содержит информацию о каждой возможной ошибке: название, возможные причины и рекомендуемые действия.
     */
    FaultInfo _faultTable[_faultCount] = {
        { "OU1 (1)", "Перенапряжение во время разгона , Ненормальное входное напряжение", "Проверьте входное питание" },
        { "OU2 (2)", "Перенапряжение во время торможения, Время торможения слишком короткое", "Увеличьте время торможения" },
        { "OU3 (3)", "Перенапряжение на постоянной скорости, Ненормальное входное напряжение", "Проверьте входное питание" },
        { "OCC1 (4)", "Аппаратный перегрузка тока во время разгона, Мощность привода переменного тока низкая", "Выберите привод переменного тока с большей мощностью" },
        { "OCC2 (5)", "Аппаратный перегрузка тока во время торможения, Низкая мощность привода переменного тока", "Выберите привод переменного тока с большей мощностью" },
        { "OCC3 (6)", "Аппаратный перегрузка тока на постоянной скорости, Низкая мощность привода переменного тока", "Выберите привод переменного тока с большей мощностью" },
        { "OCS1 (7)", "Программная перегрузка тока во время разгона, Низкая мощность привода переменного тока", "Выберите привод переменного тока с большей мощностью" },
        { "OCS2 (8)", "Программная перегрузка тока во время торможения, Время торможения слишком короткое", "Увеличьте время торможения" },
        { "OCS3 (9)", "Программная перегрузка тока на постоянной скорости, Ненормальное входное напряжение", "Проверьте входное питание" },
        { "EFO (10)", "Модуль отключения питания, Ненормальное входное напряжение", "Проверьте входное напряжение" },
        { "OU (11)", "Перенапряжение при остановке, Ненормальное входное напряжение", "Проверьте входное напряжение" },
        { "OU3 (12)", "Перенапряжение на постоянной скорости, Слишком высокое напряжение питания", "Проверьте, не слишком ли высокое напряжение питания" },
        { "LU (13)", "Недостаточное напряжение, Ненормальное входное напряжение", "Проверьте напряжение питания" },
        { "OH (14)", "Перегрев, Слишком высокая температура окружающей среды", "Улучшите условия окружающей среды" },
        { "OL1 (15)", "Перегрузка привода переменного тока, Перегрузка двигателя", "Проверьте нагрузку" },
        { "OL2 (16)", "Перегрев, Слишком высокая температура окружающей среды", "Улучшите условия окружающей среды" },
        { "BIAS (17)", "Ошибка смещения тока, Аппаратный сбой", "Обратитесь к поставщику за обслуживанием" },
        { "CBC (18)", "Ошибка ограничения тока по волнам, Низкая мощность привода переменного тока", "Выберите привод переменного тока с большей мощностью" },
        { "FBL (19)", "Обратная связь PID ниже нижнего предела, Линия обратной связи PID ослаблена", "Проверьте соединение обратной связи" },
        { "FBH (20)", "Обратная связь PID выше верхнего предела, Проверьте соединение обратной связи", "Проверьте соединение обратной связи" },
        { "EEEP (21)", "Ошибка чтения и записи EEPROM, Ошибка EEPROM", "Обратитесь к поставщику за обслуживанием" },
        { "CE (22)", "Ошибка связи между двойными ЦП, Ошибка связи ЦП", "Обратитесь к поставщику за обслуживанием" },
        { "EF (23)", "Внешняя ошибка, Входной терминал внешнего устройства закрыт", "Отключите входной терминал внешнего устройства и устраните неисправность" },
        { "EPA (24)", "Ошибка настройки параметров", "" },
        { "E485 (25)", "Ошибка разъединения связи", "Проверьте, не аномально ли соединение линии связи и правильность последовательности линии."},
        { "SFOC (27)", "Программная перегрузка тока", "Настройте время разгона/торможения; если параметры двигателя не совпадают, перенастройте параметры."}
    };
};
